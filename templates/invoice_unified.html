<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if is_gst %}Tax Invoice{% else %}Invoice{% endif %}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            font-size: 10px;
            line-height: 1.2;
            color: #000;
            background: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 10px;
        }

        .invoice-container {
            width: 21cm;
            height: 29.7cm;
            margin: 0;
            padding: 10mm;
            background: white;
            border: 2px solid #000;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        /* Header Section */
        .header-row {
            width: 100%;
            border: 1px solid #000;
            border-collapse: collapse;
            text-align: center;
            padding: 8px;
            margin: 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .invoice-title {
            font-weight: bold;
            font-size: 14px;
            flex-grow: 1;
            text-align: center;
        }

        .original-for-buyer {
            font-size: 8px;
            text-align: right;
            white-space: nowrap;
        }

        /* Company Details */
        .company-section {
            width: 100%;
            border: 1px solid #000;
            border-top: none;
            padding: 8px;
            text-align: center;
        }

        .company-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 3px;
            letter-spacing: 2px;
        }

        .company-address {
            font-size: 10px;
            margin-bottom: 2px;
        }

        /* Terms Section */
        .terms-section {
            width: 100%;
            border: 1px solid #000;
            border-top: none;
            padding: 4px 8px;
            font-size: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0;
        }

        .terms-left {
            text-align: left;
        }

        .date-right {
            text-align: right;
        }

        /* Buyer and Invoice Details */
        .details-section {
            display: table;
            width: 100%;
            border: 1px solid #000;
            border-top: none;
            border-collapse: collapse;
        }

        .buyer-details {
            display: table-cell;
            width: 60%;
            border-right: 1px solid #000;
            padding: 8px;
            vertical-align: top;
        }

        .invoice-details {
            display: table-cell;
            width: 40%;
            padding: 0;
            vertical-align: top;
        }

        .buyer-title {
            font-weight: bold;
            font-style: italic;
            margin-bottom: 5px;
        }

        .buyer-info {
            line-height: 1.3;
        }

        /* Invoice Details Table */
        .invoice-table {
            width: 100%;
            border-collapse: collapse;
        }

        .invoice-table td {
            border: 1px solid #000;
            padding: 3px 5px;
            font-size: 9px;
            text-align: center;
        }

        .invoice-table .label {
            text-align: left;
            width: 25%;
        }

        /* Items Table */
        .items-section {
            width: 100%;
            border: 1px solid #000;
            border-top: none;
            border-collapse: collapse;
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            flex: 1;
        }

        .items-table th,
        .items-table td {
            border: 1px solid #000;
            padding: 5px 2px;
            text-align: center;
            font-size: 8px;
            vertical-align: middle;
            height: auto;
        }

        .items-table th {
            background-color: #e6f3ff;
            font-weight: bold;
            font-size: 7px;
            line-height: 1.1;
        }

        .items-table .description {
            text-align: left;
            padding-left: 4px;
            width: 120px;
        }

        .items-table .sr {
            width: 15px;
        }

        .items-table .hsn {
            width: 50px;
        }

        .items-table .amount {
            text-align: right;
            padding-right: 4px;
        }

        /* Sub totals row */
        .sub-totals {
            background-color: #e8e8e8;
            font-weight: bold;
        }

        /* Bottom Section */
        .bottom-section {
            display: table;
            width: 100%;
            border: 1px solid #000;
            border-top: none;
            border-collapse: collapse;
        }

        .totals-section {
            display: table-cell;
            width: 40%;
            vertical-align: top;
        }

        .gst-summary-section {
            display: table-cell;
            width: 60%;
            border-left: 1px solid #000;
            padding: 0;
            vertical-align: top;
        }

        .gst-summary-title {
            font-weight: bold;
            text-align: center;
            padding: 5px;
            border-bottom: 1px solid #000;
            background-color: #e6f3ff;
            font-size: 9px;
        }

        .hidden {
            display: none;
        }

        /* Words and Net Amount Inline Section */
        .words-net-section {
            display: table;
            width: 100%;
            border: 1px solid #000;
            border-top: none;
            border-collapse: collapse;
        }

        .words-cell {
            display: table-cell;
            width: 70%;
            padding: 10px;
            font-size: 10px;
            border-right: 1px solid #000;
            background-color: #e6f3ff;
            vertical-align: middle;
        }

        .net-cell {
            display: table-cell;
            width: 30%;
            padding: 10px;
            text-align: center;
            vertical-align: middle;
            background-color: #e6f3ff;
        }

        .net-value {
            font-size: 16px;
            font-weight: bold;
            margin-top: 5px;
        }

        /* Footer */
        .footer-section {
            display: table;
            width: 100%;
            border: 1px solid #000;
            border-top: none;
            border-collapse: collapse;
        }

        .bank-gstin-details {
            display: table-cell;
            width: 60%;
            padding: 8px;
            vertical-align: top;
            border-right: 1px solid #000;
            font-size: 9px;
        }

        .company-signature {
            display: table-cell;
            width: 40%;
            padding: 8px;
            text-align: center;
            vertical-align: top;
        }

        .terms-conditions {
            width: 100%;
            border: 1px solid #000;
            border-top: none;
            padding: 5px 8px;
            font-size: 9px;
        }

        .footer-note {
            width: 100%;
            border: 1px solid #000;
            border-top: none;
            padding: 4px;
            text-align: center;
            font-size: 8px;
            font-style: italic;
            background-color: #f5f5f5;
        }

        /* Highlight columns for GST invoices */
        .highlight-col {
            background-color: #e6f3ff !important;
        }

        /* Print styles */
        @media print {
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                background: white;
                padding: 0;
            }
            
            .invoice-container {
                padding: 10mm;
                margin: 0;
                max-width: none;
                width: 21cm;
                min-height: 29.7cm;
                border: 2px solid #000;
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        <!-- Header -->
        <div class="header-row">
            <div class="header-content">
                <div class="invoice-title">{% if is_gst %}TAX INVOICE{% else %}INVOICE{% endif %}</div>
                <div class="original-for-buyer">Original For Buyer</div>
            </div>
        </div>

        <!-- Company Details -->
        <div class="company-section">
            <div class="company-name">{{ company_name }}</div>
            <div class="company-address">{{ company_address }}</div>
            <div class="company-address">{{ company_contact }}</div>
        </div>

        <!-- Terms and Date -->
        <div class="terms-section">
            <div class="terms-left"><strong>Terms :</strong> {{ terms }}</div>
            <div class="date-right"><strong>Date :</strong> {{ invoice_date }}</div>
        </div>

        <!-- Buyer and Invoice Details -->
        <div class="details-section">
            <div class="buyer-details">
                <div class="buyer-title">Buyer's Name and Address</div>
                <div class="buyer-info">
                    <strong>{{ buyer_name }}</strong><br>
                    {{ buyer_address }}<br><br>
                    {{ buyer_location }}<br>
                    Contact No. = {{ buyer_contact }}<br>
                    {% if is_gst %}GSTIN = {{ buyer_gstin }}{% endif %}
                </div>
            </div>
            <div class="invoice-details">
                <table class="invoice-table">
                    <tr>
                        <td class="label">Invoice No..</td>
                        <td>{{ invoice_no }}</td>
                    </tr>
                    <tr>
                        <td class="label">Ref No. & Dt</td>
                        <td>{{ ref_no }}</td>
                    </tr>
                    <tr>
                        <td class="label">Vehicle No.</td>
                        <td>{{ vehicle_no }}</td>
                    </tr>
                    <tr>
                        <td class="label">Transport</td>
                        <td>{{ transport }}</td>
                    </tr>
                    <tr>
                        <td class="label">Tax Classification</td>
                        <td>{{ tax_type }}</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Items Table - GST Version -->
        {% if is_gst %}
        <div class="items-section">
            <table class="items-table">
                <thead>
                    <tr>
                        <th class="sr">Sr</th>
                        <th class="description">Description</th>
                        <th class="hsn">HSN Code</th>
                        <th>MRP</th>
                        <th>Qty</th>
                        <th>Rate</th>
                        <th>Total Val</th>
                        <th>Discount<br>%</th>
                        <th class="highlight-col">Discount<br>Amt</th>
                        <th class="highlight-col">Taxable<br>Amt</th>
                        <th>CGST<br>%</th>
                        <th>CGST<br>Amt</th>
                        <th>SGST<br>%</th>
                        <th>SGST<br>Amt</th>
                        <th>IGST<br>%</th>
                        <th>IGST<br>Amt</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr>
                        <td class="sr">{{ loop.index }}</td>
                        <td class="description">{{ item.description }}</td>
                        <td>{{ item.hsn_code }}</td>
                        <td class="amount">{{ item.mrp }}</td>
                        <td>{{ item.quantity }}</td>
                        <td class="amount">{{ item.rate }}</td>
                        <td class="amount">{{ item.total_val }}</td>
                        <td>{{ item.discount_percent }}</td>
                        <td class="amount highlight-col">{{ item.discount_amt }}</td>
                        <td class="amount highlight-col">{{ item.taxable_amt }}</td>
                        <td>{{ item.cgst_percent }}</td>
                        <td class="amount">{{ item.cgst_amt }}</td>
                        <td>{{ item.sgst_percent }}</td>
                        <td class="amount">{{ item.sgst_amt }}</td>
                        <td>{{ item.igst_percent }}</td>
                        <td class="amount">{{ item.igst_amt }}</td>
                        <td class="amount">{{ item.total }}</td>
                    </tr>
                    {% endfor %}
                    
                    <!-- Empty rows for spacing -->
                    {% for i in range(10 - items|length) %}
                    <tr>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td class="highlight-col">&nbsp;</td>
                        <td class="highlight-col">&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                    </tr>
                    {% endfor %}

                    <!-- Sub totals -->
                    <tr class="sub-totals">
                        <td colspan="4">TOTAL</td>
                        <td>{{ total_quantity }}</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td class="amount highlight-col">{{ total_discount }}</td>
                        <td class="amount highlight-col">{{ subtotal_taxable }}</td>
                        <td colspan="2">&nbsp;</td>
                        <td class="amount">{{ total_cgst }}</td>
                        <td colspan="2">&nbsp;</td>
                        <td class="amount">{{ total_sgst }}</td>
                        <td colspan="2">&nbsp;</td>
                        <td class="amount">{{ total_igst }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Bottom Section - GST -->
        <div class="bottom-section">
            <div class="totals-section">
                <table class="invoice-table">
                    <tr>
                        <td class="label">Sub Total (Before Tax)</td>
                        <td class="amount">{{ total_before_tax }}</td>
                    </tr>
                    <tr>
                        <td class="label">Add: CGST / IGST</td>
                        <td class="amount">{{ total_cgst_igst }}</td>
                    </tr>
                    <tr>
                        <td class="label">Add: SGST</td>
                        <td class="amount">{{ total_sgst }}</td>
                    </tr>
                    <tr>
                        <td class="label">Total Tax Amount : GST</td>
                        <td class="amount">{{ total_tax_amount }}</td>
                    </tr>
                    <tr>
                        <td class="label">Total Amount After Tax</td>
                        <td class="amount">{{ total_after_tax }}</td>
                    </tr>
                    <tr>
                        <td class="label">(+) Round Off</td>
                        <td class="amount">{{ round_off }}</td>
                    </tr>
                </table>
            </div>

            <!-- GST Summary -->
            <div class="gst-summary-section">
                <div class="gst-summary-title">GST SUMMARY</div>
                <table class="invoice-table">
                    <tr>
                        <th class="label">Rate</th>
                        <th>Taxable Amt</th>
                        <th>SGST Amt</th>
                        <th>CGST Amt</th>
                        <th>Tax Amt</th>
                    </tr>
                    {% for item in gst_summary %}
                    <tr>
                        <td class="label">{{ item.rate }}%</td>
                        <td class="amount">{{ item.taxable_amt }}</td>
                        <td class="amount">{{ item.sgst_amt }}</td>
                        <td class="amount">{{ item.cgst_amt }}</td>
                        <td class="amount">{{ item.tax_amt }}</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>

        {% else %}

        <!-- Items Table - Non-GST Version -->
        <div class="items-section">
            <table class="items-table">
                <thead>
                    <tr>
                        <th class="sr">Sr</th>
                        <th class="description">Description</th>
                        <th class="hsn">HSN Code</th>
                        <th>Qty</th>
                        <th>Rate</th>
                        <th>Total Val</th>
                        <th>Discount %</th>
                        <th>Discount Amt</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr>
                        <td class="sr">{{ loop.index }}</td>
                        <td class="description">{{ item.description }}</td>
                        <td>{{ item.hsn_code }}</td>
                        <td>{{ item.quantity }}</td>
                        <td class="amount">{{ item.rate }}</td>
                        <td class="amount">{{ item.total_val }}</td>
                        <td>{{ item.discount_percent }}</td>
                        <td class="amount">{{ item.discount_amt }}</td>
                        <td class="amount">{{ item.total }}</td>
                    </tr>
                    {% endfor %}
                    
                    <!-- Empty rows for spacing -->
                    {% for i in range(10 - items|length) %}
                    <tr>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                    </tr>
                    {% endfor %}

                    <!-- Sub totals -->
                    <tr class="sub-totals">
                        <td colspan="3">TOTAL</td>
                        <td>{{ total_quantity }}</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td class="amount">{{ total_discount }}</td>
                        <td class="amount">{{ net_amount }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Bottom Section - Non-GST -->
        <div class="words-net-section">
            <div class="words-cell">
                <strong>In Words :</strong> {{ amount_in_words }}
            </div>
            <div class="net-cell">
                <strong>Net Amount</strong>
                <div class="net-value">{{ net_amount }}</div>
            </div>
        </div>

        {% endif %}

        <!-- Amount in Words and Net Amount Row (GST only) -->
        {% if is_gst %}
        <div class="words-net-section">
            <div class="words-cell">
                <strong>In Words :</strong> {{ amount_in_words }}
            </div>
            <div class="net-cell">
                <strong>Net Amount</strong>
                <div class="net-value">{{ net_amount }}</div>
            </div>
        </div>
        {% endif %}

        <!-- GSTIN and Bank Details Combined -->
        <div class="footer-section">
            <div class="bank-gstin-details">
                {% if is_gst %}<strong>GSTIN : {{ company_gstin }}</strong><br><br>{% endif %}
                <strong>Bank Details :</strong><br>
                {{ bank_name }}<br>
                {{ bank_account }}<br>
                {{ bank_ifsc }}
            </div>
            <div class="company-signature">
                <div style="text-align: right; margin-top: 30px;">
                    <strong>For {{ company_name }}</strong>
                </div>
            </div>
        </div>

        <!-- Terms & Conditions -->
        <div class="terms-conditions">
            <strong>Terms & Conditions:</strong><br>
            {{ terms_conditions }}
        </div>

        <!-- Footer Note -->
        <div class="footer-note">
            This is computer generated invoice hence not require signature
        </div>
    </div>
</body>
</html>
